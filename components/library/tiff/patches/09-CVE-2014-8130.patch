From 3c5eb8b1be544e41d2c336191bc4936300ad7543 Mon Sep 17 00:00:00 2001
From: bfriesen <bfriesen>
Date: Sun, 18 Nov 2012 17:51:52 +0000
Subject: [PATCH] * libtiff/tif_{unix,vms,win32}.c (_TIFFmalloc): ANSI C does
 not require malloc() to return NULL pointer if requested allocation size is
 zero.  Assure that _TIFFmalloc does.

---
 ChangeLog           | 6 ++++++
 libtiff/tif_unix.c  | 3 +++
 libtiff/tif_vms.c   | 3 +++
 libtiff/tif_win32.c | 3 +++
 4 files changed, 15 insertions(+)

Index: tiff-4.0.3/libtiff/tif_unix.c
===================================================================
--- tiff-4.0.3.orig/libtiff/tif_unix.c	2015-03-27 14:47:11.002353413 -0400
+++ tiff-4.0.3/libtiff/tif_unix.c	2015-03-27 14:47:10.998353377 -0400
@@ -257,6 +257,9 @@
 void*
 _TIFFmalloc(tmsize_t s)
 {
+        if (s == 0)
+                return ((void *) NULL);
+
 	return (malloc((size_t) s));
 }
 
Index: tiff-4.0.3/libtiff/tif_win32.c
===================================================================
--- tiff-4.0.3.orig/libtiff/tif_win32.c	2015-03-27 14:47:11.002353413 -0400
+++ tiff-4.0.3/libtiff/tif_win32.c	2015-03-27 14:47:10.998353377 -0400
@@ -329,6 +329,9 @@
 void*
 _TIFFmalloc(tmsize_t s)
 {
+        if (s == 0)
+                return ((void *) NULL);
+
 	return (malloc((size_t) s));
 }
 
