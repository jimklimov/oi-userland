Backport of:

From 77837423c3a125a3b39ddae246ff904f437cf845 Mon Sep 17 00:00:00 2001
From: bfriesen <bfriesen>
Date: Mon, 22 Dec 2014 02:52:38 +0000
Subject: [PATCH] * tools/tiffdump.c: Guard against arithmetic overflow when
 calculating allocation buffer sizes.

---
 ChangeLog        |  5 +++++
 tools/tiffdump.c | 21 ++++++++++++++++++---
 2 files changed, 23 insertions(+), 3 deletions(-)

Index: tiff-4.0.3/tools/tiffdump.c
===================================================================
--- tiff-4.0.3.orig/tools/tiffdump.c	2015-01-29 09:36:19.521556646 -0500
+++ tiff-4.0.3/tools/tiffdump.c	2015-01-29 09:36:19.521556646 -0500
@@ -34,6 +34,8 @@
 # include <unistd.h>
 #endif
 
+#include "tiffiop.h"
+
 #ifdef HAVE_FCNTL_H
 # include <fcntl.h>
 #endif
@@ -303,7 +305,7 @@
 		dircount = (uint16)dircount64;
 		direntrysize = 20;
 	}
-	dirmem = _TIFFmalloc(dircount * direntrysize);
+	dirmem = _TIFFmalloc(TIFFSafeMultiply(tmsize_t,dircount,direntrysize));
 	if (dirmem == NULL) {
 		Fatal("No space for TIFF directory");
 		goto done;
